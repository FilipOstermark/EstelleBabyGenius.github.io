<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" type="text/css" href="style.css">
<title>KMHL 18/19 - BETS</title>
<link rel="shortcut icon" type="image/x-icon" href="favicon.ico"/>
<script type="text/javascript">

const bets = `{
    "name" : "",
    "bets" : {
        "division" : [ {
            "name" : "Metropolitan",
            "rank" : [ 
                "",
                "",
                "",
                "",
                "",
                "",
                "",
                ""
                ],
            "wildcards" : []
        }, {
            "name" : "Atlantic",
            "rank" : [ 
                "",
                "",
                "",
                "",
                "",
                "",
                "",
                ""
                ],
            "wildcards" : []
        }, {
            "name" : "Central",
            "rank" : [ 
                "",
                "",
                "",
                "",
                "",
                "",
                ""
                ],
            "wildcards" : []
        }, {
            "name" : "Pacific",
            "rank" : [ 
                "",
                "",
                "",
                "",
                "",
                "",
                "",
                ""
                ],
            "wildcards" : []
        }],
        "president" : "",
        "antipresident" : ""
    }
}`;

/**
 * @param parsedBets.name
 * @param parsedBets.bets
 * @param parsedBets.bets.division
 * @param parsedBets.bets.division.rank
 * @param parsedBets.bets.division.wildcards
 * @param parsedBets.bets.president
 * @param parsedBets.bets.antipresident
 * @type {object}
 */
let parsedBets = JSON.parse(bets);

function main() {
    document.getElementById("mainContent").style.opacity = "0.85";

    for (let i = 1; i <= 8; i++) {
        let id = "m" + i.toString();
        document.getElementById(id.toString()).addEventListener('dragstart', drag, false);
        document.getElementById(id.toString()).addEventListener('dragenter', allowDrop, false);
        document.getElementById(id.toString()).addEventListener('dragover', dragOver, false);
        document.getElementById(id.toString()).addEventListener('dragleave', dragLeave, false);
        document.getElementById(id.toString()).addEventListener('drop', drop, false);
    }
    for (let i = 1; i <= 8; i++) {
        let id = "a" + i.toString();
        document.getElementById(id.toString()).addEventListener('dragstart', drag, false);
        document.getElementById(id.toString()).addEventListener('dragenter', allowDrop, false);
        document.getElementById(id.toString()).addEventListener('dragover', dragOver, false);
        document.getElementById(id.toString()).addEventListener('dragleave', dragLeave, false);
        document.getElementById(id.toString()).addEventListener('drop', drop, false);
    }
    for (let i = 1; i <= 7; i++) {
        let id = "c" + i.toString();
        document.getElementById(id.toString()).addEventListener('dragstart', drag, false);
        document.getElementById(id.toString()).addEventListener('dragenter', allowDrop, false);
        document.getElementById(id.toString()).addEventListener('dragover', dragOver, false);
        document.getElementById(id.toString()).addEventListener('dragleave', dragLeave, false);
        document.getElementById(id.toString()).addEventListener('drop', drop, false);
    }
    for (let i = 1; i <= 8; i++) {
        let id = "p" + i.toString();
        document.getElementById(id.toString()).addEventListener('dragstart', drag, false);
        document.getElementById(id.toString()).addEventListener('dragenter', allowDrop, false);
        document.getElementById(id.toString()).addEventListener('dragover', dragOver, false);
        document.getElementById(id.toString()).addEventListener('dragleave', dragLeave, false);
        document.getElementById(id.toString()).addEventListener('drop', drop, false);
    }
}

function drag(ev) {
    ev.dataTransfer.setData("text", ev.target.id);
}

function allowDrop(ev) {
    ev.preventDefault();

    let style = ev.target.style;
    style.opacity = "0.75";
    style.color = "orange";

    return false;
}

function dragOver(ev) {
    ev.preventDefault();
    return false;
}

function dragLeave(ev) {
    ev.preventDefault();

    let style = ev.target.style;
    style.opacity = "1";
    style.color = "white";

    return false;
}

function drop(ev) {
    ev.preventDefault();
    let style = ev.target.style;
    style.opacity = "1";
    style.color = "white";

    let source_element = ev.dataTransfer.getData("text");
    let prev_inner = ev.target.innerHTML;
    let source_div_letter = source_element.substring(0,1);
    let target_div_letter = ev.target.id.substring(0,1);
    if (source_div_letter !== target_div_letter) {
        return 1;
    }

    ev.target.innerHTML = document.getElementById(source_element).innerHTML;

    let source_id = parseInt(source_element.substring(1), 10);
    let target_id = parseInt(ev.target.id.substring(1), 10);

    if (target_id < source_id) {
        let new_inner;
        for (let i = target_id+1; i <= source_id; i++) {
            let id = target_div_letter + i.toString();
            new_inner = document.getElementById(id).innerHTML;
            document.getElementById(id).innerHTML = prev_inner;
            prev_inner = new_inner
        }
    } else {
        let new_inner;
        for (let i = target_id-1; i >= source_id; i--) {
            let id = target_div_letter + i.toString();
            new_inner = document.getElementById(id).innerHTML;
            document.getElementById(id).innerHTML = prev_inner;
            prev_inner = new_inner
        }
    }
}

function send_bets() {

    let url_string = window.location.href;
    console.log(url_string);
    let url = new URL(url_string);
    let name = url.searchParams.get("name");
    console.log(name);

    parsedBets.name = "xxx";

    for (let i=0; i < 8; i++) {
        let element_id = "m" + (i+1).toString();
        parsedBets.bets.division[0].rank[i] = document.getElementById(element_id).innerHTML;
    }
    for (let i=0; i < 8; i++) {
        let element_id = "a" + (i+1).toString();
        parsedBets.bets.division[1].rank[i] = document.getElementById(element_id).innerHTML;
    }
    for (let i=0; i < 7; i++) {
        let element_id = "c" + (i+1).toString();
        parsedBets.bets.division[2].rank[i] = document.getElementById(element_id).innerHTML;
    }
    for (let i=0; i < 8; i++) {
        let element_id = "p" + (i+1).toString();
        parsedBets.bets.division[3].rank[i] = document.getElementById(element_id).innerHTML;
    }

    let bets_json = JSON.stringify(parsedBets);
    alert(bets_json);
}

</script>
</head>

<body>
    <div id="background-image"></div>
    <header id="titlelogo" class="inline-block-center">
        <h1>KM</h1>
        <img id="logo" src="nhllogo.svg" alt="nhllogo">
        <h1>BETS</h1>
    </header>

    <section id="mainContent">
        <article id="leagueSection" class="division">
            <div id="totalScoreboard" class="betsform">
                <div class="divisionColumn">
                    <h2>Metropolitan Division</h2>
                    <ol id="metropolitanList">
                        <li class="teamPosition" id="m1" draggable="true">Washington Capitals</li>
                        <li class="teamPosition" id="m2" draggable="true">Pittsburgh Penguins</li>
                        <li class="teamPosition" id="m3" draggable="true">Columbus Blue Jackets</li>
                        <li class="teamPosition" id="m4" draggable="true">New Jersey Devils</li>
                        <li class="teamPosition" id="m5" draggable="true">New York Rangers</li>
                        <li class="teamPosition" id="m6" draggable="true">Philadelphia Flyers</li>
                        <li class="teamPosition" id="m7" draggable="true">New York Islanders</li>
                        <li class="teamPosition" id="m8" draggable="true">Carolina Hurricanes</li>
                    </ol>
                </div>

                <div class="divisionColumn">
                    <h2>Atlantic Division</h2>
                    <ol id="atlanticList">
                        <li class="teamPosition" id="a1" draggable="true">Toronto Maple Leafs</li>
                        <li class="teamPosition" id="a2" draggable="true">Boston Bruins</li>
                        <li class="teamPosition" id="a3" draggable="true">Detroit Red Wings</li>
                        <li class="teamPosition" id="a4" draggable="true">Montréal Canadiens</li>
                        <li class="teamPosition" id="a5" draggable="true">Ottawa Senators</li>
                        <li class="teamPosition" id="a6" draggable="true">Florida Panthers</li>
                        <li class="teamPosition" id="a7" draggable="true">Tampa Bay Lightning</li>
                        <li class="teamPosition" id="a8" draggable="true">Buffalo Sabres</li>
                    </ol>
                </div>

                <div class="divisionColumn">
                    <h2>Central Division</h2>
                    <ol id="centralList">
                        <li class="teamPosition" id="c1" draggable="true">Chicago Blackhawks</li>
                        <li class="teamPosition" id="c2" draggable="true">Nashville Predators</li>
                        <li class="teamPosition" id="c3" draggable="true">St. Louis Blues</li>
                        <li class="teamPosition" id="c4" draggable="true">Winnipeg Jets</li>
                        <li class="teamPosition" id="c5" draggable="true">Colorado Avalanche</li>
                        <li class="teamPosition" id="c6" draggable="true">Dallas Stars</li>
                        <li class="teamPosition" id="c7" draggable="true">Minnesota Wild</li>
                        <li class="teamPosition" id="filler" style="opacity: 0" draggable="false"></li>
                    </ol>
                </div>

                <div class="divisionColumn">
                    <h2>Pacific Division</h2>
                    <ol id="pacificList">
                        <li class="teamPosition" id="p1" draggable="true">Anaheim Ducks</li>
                        <li class="teamPosition" id="p2" draggable="true">Edmonton Oilers</li>
                        <li class="teamPosition" id="p3" draggable="true">San Jose Sharks</li>
                        <li class="teamPosition" id="p4" draggable="true">Los Angeles Kings</li>
                        <li class="teamPosition" id="p5" draggable="true">Calgary Flames</li>
                        <li class="teamPosition" id="p6" draggable="true">Vancouver Canucks</li>
                        <li class="teamPosition" id="p7" draggable="true">Arizona Coyotes</li>
                        <li class="teamPosition" id="p8" draggable="true">Vegas Golden Knights</li>
                    </ol>
                </div>


                <div class="divisionColumn">
                    <h2>Eastern Wildcards</h2>
                    <select title="Eastern Wildcard 1">
                        <option value="Washington Capitals">Washington Capitals</option>
                        <option value="Pittsburgh Penguins">Pittsburgh Penguins</option>
                        <option value="Columbus Blue Jackets">Columbus Blue Jackets</option>
                        <option value="New Jersey Devils">New Jersey Devils</option>
                        <option value="New York Rangers">New York Rangers</option>
                        <option value="Philadelphia Flyers">Philadelphia Flyers</option>
                        <option value="New York Islanders">New York Islanders</option>
                        <option value="Carolina Hurricanes">Carolina Hurricanes</option>
                        <option value="Toronto Maple Leafs">Toronto Maple Leafs</option>
                        <option value="Boston Bruins">Boston Bruins</option>
                        <option value="Detroit Red Wings">Detroit Red Wings</option>
                        <option value="Montréal Canadiens">Montréal Canadiens</option>
                        <option value="Ottawa Senators">Ottawa Senators</option>
                        <option value="Florida Panthers">Florida Panthers</option>
                        <option value="Tampa Bay Lightning">Tampa Bay Lightning</option>
                        <option value="Buffalo Sabres">Buffalo Sabres</option>
                    </select>
                    <select title="Eastern Wildcard 2">
                        <option value="Washington Capitals">Washington Capitals</option>
                        <option value="Pittsburgh Penguins">Pittsburgh Penguins</option>
                        <option value="Columbus Blue Jackets">Columbus Blue Jackets</option>
                        <option value="New Jersey Devils">New Jersey Devils</option>
                        <option value="New York Rangers">New York Rangers</option>
                        <option value="Philadelphia Flyers">Philadelphia Flyers</option>
                        <option value="New York Islanders">New York Islanders</option>
                        <option value="Carolina Hurricanes">Carolina Hurricanes</option>
                        <option value="Toronto Maple Leafs">Toronto Maple Leafs</option>
                        <option value="Boston Bruins">Boston Bruins</option>
                        <option value="Detroit Red Wings">Detroit Red Wings</option>
                        <option value="Montréal Canadiens">Montréal Canadiens</option>
                        <option value="Ottawa Senators">Ottawa Senators</option>
                        <option value="Florida Panthers">Florida Panthers</option>
                        <option value="Tampa Bay Lightning">Tampa Bay Lightning</option>
                        <option value="Buffalo Sabres">Buffalo Sabres</option>
                    </select>
                </div>
                <h2>Western Wildcards</h2>
                <select title="Western Wildcard 1">
                    <option value="Washington Capitals">Washington Capitals</option>
                    <option value="Pittsburgh Penguins">Pittsburgh Penguins</option>
                    <option value="Columbus Blue Jackets">Columbus Blue Jackets</option>
                    <option value="New Jersey Devils">New Jersey Devils</option>
                    <option value="New York Rangers">New York Rangers</option>
                    <option value="Philadelphia Flyers">Philadelphia Flyers</option>
                    <option value="New York Islanders">New York Islanders</option>
                    <option value="Carolina Hurricanes">Carolina Hurricanes</option>
                    <option value="Toronto Maple Leafs">Toronto Maple Leafs</option>
                    <option value="Boston Bruins">Boston Bruins</option>
                    <option value="Detroit Red Wings">Detroit Red Wings</option>
                    <option value="Montréal Canadiens">Montréal Canadiens</option>
                    <option value="Ottawa Senators">Ottawa Senators</option>
                    <option value="Florida Panthers">Florida Panthers</option>
                    <option value="Tampa Bay Lightning">Tampa Bay Lightning</option>
                    <option value="Buffalo Sabres">Buffalo Sabres</option>
                </select>
                <select title="Western Wildcard 2">
                    <option value="Washington Capitals">Washington Capitals</option>
                    <option value="Pittsburgh Penguins">Pittsburgh Penguins</option>
                    <option value="Columbus Blue Jackets">Columbus Blue Jackets</option>
                    <option value="New Jersey Devils">New Jersey Devils</option>
                    <option value="New York Rangers">New York Rangers</option>
                    <option value="Philadelphia Flyers">Philadelphia Flyers</option>
                    <option value="New York Islanders">New York Islanders</option>
                    <option value="Carolina Hurricanes">Carolina Hurricanes</option>
                    <option value="Toronto Maple Leafs">Toronto Maple Leafs</option>
                    <option value="Boston Bruins">Boston Bruins</option>
                    <option value="Detroit Red Wings">Detroit Red Wings</option>
                    <option value="Montréal Canadiens">Montréal Canadiens</option>
                    <option value="Ottawa Senators">Ottawa Senators</option>
                    <option value="Florida Panthers">Florida Panthers</option>
                    <option value="Tampa Bay Lightning">Tampa Bay Lightning</option>
                    <option value="Buffalo Sabres">Buffalo Sabres</option>
                </select>
                <h2>President's Trophy</h2>
                <select title="Western Wildcard 1">
                    <option value="Washington Capitals">Washington Capitals</option>
                    <option value="Pittsburgh Penguins">Pittsburgh Penguins</option>
                    <option value="Columbus Blue Jackets">Columbus Blue Jackets</option>
                    <option value="New Jersey Devils">New Jersey Devils</option>
                    <option value="New York Rangers">New York Rangers</option>
                    <option value="Philadelphia Flyers">Philadelphia Flyers</option>
                    <option value="New York Islanders">New York Islanders</option>
                    <option value="Carolina Hurricanes">Carolina Hurricanes</option>
                    <option value="Toronto Maple Leafs">Toronto Maple Leafs</option>
                    <option value="Boston Bruins">Boston Bruins</option>
                    <option value="Detroit Red Wings">Detroit Red Wings</option>
                    <option value="Montréal Canadiens">Montréal Canadiens</option>
                    <option value="Ottawa Senators">Ottawa Senators</option>
                    <option value="Florida Panthers">Florida Panthers</option>
                    <option value="Tampa Bay Lightning">Tampa Bay Lightning</option>
                    <option value="Buffalo Sabres">Buffalo Sabres</option>
                </select>
                <h2>Anti-President's Trophy</h2>
                <select title="Western Wildcard 1">
                    <option value="Washington Capitals">Washington Capitals</option>
                    <option value="Pittsburgh Penguins">Pittsburgh Penguins</option>
                    <option value="Columbus Blue Jackets">Columbus Blue Jackets</option>
                    <option value="New Jersey Devils">New Jersey Devils</option>
                    <option value="New York Rangers">New York Rangers</option>
                    <option value="Philadelphia Flyers">Philadelphia Flyers</option>
                    <option value="New York Islanders">New York Islanders</option>
                    <option value="Carolina Hurricanes">Carolina Hurricanes</option>
                    <option value="Toronto Maple Leafs">Toronto Maple Leafs</option>
                    <option value="Boston Bruins">Boston Bruins</option>
                    <option value="Detroit Red Wings">Detroit Red Wings</option>
                    <option value="Montréal Canadiens">Montréal Canadiens</option>
                    <option value="Ottawa Senators">Ottawa Senators</option>
                    <option value="Florida Panthers">Florida Panthers</option>
                    <option value="Tampa Bay Lightning">Tampa Bay Lightning</option>
                    <option value="Buffalo Sabres">Buffalo Sabres</option>
                </select>
                <button class="betsformSubmit" type="submit" onclick="send_bets()">Skicka!</button>
            </div>
        </article>
    </section>

    <footer id="seasonFooter">
        <h1>2018</h1>
        <hr>
        <h1>2019</h1>
        <br>
        <p id="misc">Misc:</p>
        <a href="km-nhl-bets-20172018.pdf" class="miscLink">Bet PDF</a>
        <a href="weekday/index.html" class="miscLink">Weekday Calculator</a>
        <a href="retroradio/index.html" class="miscLink">RetroRadio</a>
        <p id="copyright">&copy; 2018 Filip Östermark<p>
    </footer>

    <script type="text/javascript">
    window.onload = main;
    </script>
</body>
</html>